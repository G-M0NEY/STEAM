<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Game!</title>
    <script src="https://unpkg.com/kaboom@2000.0.0-beta.24/dist/kaboom.js"></script>
</head>
<body>
    <script type="module">

        // import kaboom lib
        import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";
        
        // initialize kaboom context
        kaboom();
        
        // load a sprite "bean" from an image
        loadSprite("santa", "./media/santa.png")
        loadSprite("ground", "./media/ground1.png")
        loadSprite("coin", "./media/mistletoe.png")

// define some constants
const JUMP_FORCE = 1320
const MOVE_SPEED = 480
const FALL_DEATH = 2400

const LEVELS = [
	[
		"                          $",
		"                          $",
		"                          $",
		"                          $",
		"                          $",
		"           $$         =   $",
		"  %      ====         =   $",
		"                      =   $",
		"                      =    ",
		"       ^^      = >    =   @",
		"===========================",
	],
	[
		"     $    $    $    $     $",
		"     $    $    $    $     $",
		"                           ",
		"                           ",
		"                           ",
		"                           ",
		"                           ",
		" ^^^^>^^^^>^^^^>^^^^>^^^^^@",
		"===========================",
	],
]
// define what each symbol means in the level graph
const levelConf = {
	// grid size
	width: 64,
	height: 64,
	// define each object as a list of components
	"=": () => [
		sprite("ground"),
		area(),
		solid(),
		origin("bot"),
	],
	"$": () => [
		sprite("coin"),
		area(),
		pos(0, -9),
		origin("bot"),
		"coin",
	],
	"%": () => [
		sprite("prize"),
		area(),
		solid(),
		origin("bot"),
		"prize",
	],
	"^": () => [
		sprite("spike"),
		area(),
		solid(),
		origin("bot"),
		"danger",
	],
	"#": () => [
		sprite("apple"),
		area(),
		origin("bot"),
		body(),
		"apple",
	],
	">": () => [
		sprite("ghosty"),
		area(),
		origin("bot"),
		body(),
		patrol(),
		"enemy",
	],
	"@": () => [
		sprite("portal"),
		area({ scale: 0.5, }),
		origin("bot"),
		pos(0, -12),
		"portal",
	],
}

scene("game", ({ levelId, coins } = { levelId: 0, coins: 0 }) => {

gravity(3200)

// add level to scene
const level = addLevel(LEVELS[levelId ?? 0], levelConf)


        // add something to screen
        const player = add([
            sprite("santa"),
            pos(0, 0),
            area(),
            scale(1),
            body(),
        ])

        // action() runs every frame
	    player.onUpdate(() => {
	    	// center camera to player
	    	camPos(player.pos)
	    	// check fall death
	    	if (player.pos.y >= FALL_DEATH) {
	    		go("lose")
	    	}
	    })
        
        </script>
</body>
</html>
